var ie=Object.defineProperty,re=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var M=(n,e,t)=>e in n?ie(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,V=(n,e)=>{for(var t in e||(e={}))oe.call(e,t)&&M(n,t,e[t]);if(R)for(var t of R(e))ae.call(e,t)&&M(n,t,e[t]);return n},H=(n,e)=>re(n,se(e));var h=(n,e,t)=>(M(n,typeof e!="symbol"?e+"":e,t),t);class E{constructor(e){this.properties=e!=null?e:[]}get(e){const t=this.properties.filter(i=>i.name===e).map(i=>i.value);if(t.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(t.length!==0)return t[0]}getString(e){return this.getByType(e,"string")}getNumber(e){return this.getByType(e,"number")}getBoolean(e){return this.getByType(e,"boolean")}getByType(e,t){const i=this.get(e);if(i!==void 0){if(typeof i!==t)throw new Error('Expected property "'+e+'" to have type "'+t+'"');return i}}mustGetString(e){return this.mustGetByType(e,"string")}mustGetNumber(e){return this.mustGetByType(e,"number")}mustGetBoolean(e){return this.mustGetByType(e,"boolean")}mustGetByType(e,t){const i=this.get(e);if(i===void 0)throw new Error('Property "'+e+'" is missing');if(typeof i!==t)throw new Error('Expected property "'+e+'" to have type "'+t+'"');return i}getType(e){const t=this.properties.filter(i=>i.name===e).map(i=>i.type);if(t.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(t.length!==0)return t[0]}}const B="https://unpkg.com/@workadventure/scripting-api-extra@1.3.2/dist";class ue{constructor(e){this.name=e.name,this.x=e.x,this.y=e.y,this.properties=new E(e.properties)}get isReadable(){const e=this.properties.getString("readableBy");return e?WA.player.tags.includes(e):!0}get isWritable(){const e=this.properties.getString("writableBy");return e?WA.player.tags.includes(e):!0}}function N(n){const e=n?"#"+n.join():"";WA.nav.openCoWebSite(B+"/configuration.html"+e)}async function le(n,e){const t=await WA.room.getTiledMap(),i=new Map;return $(t.layers,i,n,e),i}function $(n,e,t,i){for(const r of n)if(r.type==="objectgroup"){for(const s of r.objects)if(s.type==="variable"){if(!!t&&r.name!==t||!!i&&!i.includes(s.name))continue;e.set(s.name,new ue(s))}}else r.type==="group"&&$(r.layers,e,t,i)}let Q;async function G(){return Q===void 0&&(Q=pe()),Q}async function pe(){return he(await WA.room.getTiledMap())}function he(n){const e=new Map;return X(n.layers,"",e),e}function X(n,e,t){for(const i of n)i.type==="group"?X(i.layers,e+i.name+"/",t):(i.name=e+i.name,t.set(i.name,i))}function ce(n){let e=1/0,t=1/0,i=0,r=0;const s=n.data;if(typeof s=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let o=0;o<n.height;o++)for(let u=0;u<n.width;u++)s[u+o*n.width]!==0&&(e=Math.min(e,u),r=Math.max(r,u),t=Math.min(t,o),i=Math.max(i,o));return{top:t,left:e,right:r+1,bottom:i+1}}function Y(n){let e=1/0,t=1/0,i=0,r=0;for(const s of n){const o=ce(s);o.left<e&&(e=o.left),o.top<t&&(t=o.top),o.right>r&&(r=o.right),o.bottom>i&&(i=o.bottom)}return{top:t,left:e,right:r,bottom:i}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var fe=Object.prototype.toString,L=Array.isArray||function(e){return fe.call(e)==="[object Array]"};function I(n){return typeof n=="function"}function de(n){return L(n)?"array":typeof n}function F(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function U(n,e){return n!=null&&typeof n=="object"&&e in n}function ge(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}var ye=RegExp.prototype.test;function me(n,e){return ye.call(n,e)}var be=/\S/;function Pe(n){return!me(be,n)}var we={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Ae(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return we[t]})}var ve=/\s*/,Ce=/\s+/,K=/\s*=/,We=/\s*\}/,Le=/#|\^|\/|>|\{|&|=|!/;function Se(n,e){if(!n)return[];var t=!1,i=[],r=[],s=[],o=!1,u=!1,a="",p=0;function d(){if(o&&!u)for(;s.length;)delete r[s.pop()];else s=[];o=!1,u=!1}var y,b,f;function v(A){if(typeof A=="string"&&(A=A.split(Ce,2)),!L(A)||A.length!==2)throw new Error("Invalid tags: "+A);y=new RegExp(F(A[0])+"\\s*"),b=new RegExp("\\s*"+F(A[1])),f=new RegExp("\\s*"+F("}"+A[1]))}v(e||P.tags);for(var l=new k(n),c,g,w,S,x,C;!l.eos();){if(c=l.pos,w=l.scanUntil(y),w)for(var q=0,ne=w.length;q<ne;++q)S=w.charAt(q),Pe(S)?(s.push(r.length),a+=S):(u=!0,t=!0,a+=" "),r.push(["text",S,c,c+1]),c+=1,S===`
`&&(d(),a="",p=0,t=!1);if(!l.scan(y))break;if(o=!0,g=l.scan(Le)||"name",l.scan(ve),g==="="?(w=l.scanUntil(K),l.scan(K),l.scanUntil(b)):g==="{"?(w=l.scanUntil(f),l.scan(We),l.scanUntil(b),g="&"):w=l.scanUntil(b),!l.scan(b))throw new Error("Unclosed tag at "+l.pos);if(g==">"?x=[g,w,c,l.pos,a,p,t]:x=[g,w,c,l.pos],p++,r.push(x),g==="#"||g==="^")i.push(x);else if(g==="/"){if(C=i.pop(),!C)throw new Error('Unopened section "'+w+'" at '+c);if(C[1]!==w)throw new Error('Unclosed section "'+C[1]+'" at '+c)}else g==="name"||g==="{"||g==="&"?u=!0:g==="="&&v(w)}if(d(),C=i.pop(),C)throw new Error('Unclosed section "'+C[1]+'" at '+l.pos);return Te(Ee(r))}function Ee(n){for(var e=[],t,i,r=0,s=n.length;r<s;++r)t=n[r],t&&(t[0]==="text"&&i&&i[0]==="text"?(i[1]+=t[1],i[3]=t[3]):(e.push(t),i=t));return e}function Te(n){for(var e=[],t=e,i=[],r,s,o=0,u=n.length;o<u;++o)switch(r=n[o],r[0]){case"#":case"^":t.push(r),i.push(r),t=r[4]=[];break;case"/":s=i.pop(),s[5]=r[2],t=i.length>0?i[i.length-1][4]:e;break;default:t.push(r)}return e}function k(n){this.string=n,this.tail=n,this.pos=0}k.prototype.eos=function(){return this.tail===""};k.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var i=t[0];return this.tail=this.tail.substring(i.length),this.pos+=i.length,i};k.prototype.scanUntil=function(e){var t=this.tail.search(e),i;switch(t){case-1:i=this.tail,this.tail="";break;case 0:i="";break;default:i=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=i.length,i};function W(n,e){this.view=n,this.cache={".":this.view},this.parent=e}W.prototype.push=function(e){return new W(e,this)};W.prototype.lookup=function(e){var t=this.cache,i;if(t.hasOwnProperty(e))i=t[e];else{for(var r=this,s,o,u,a=!1;r;){if(e.indexOf(".")>0)for(s=r.view,o=e.split("."),u=0;s!=null&&u<o.length;)u===o.length-1&&(a=U(s,o[u])||ge(s,o[u])),s=s[o[u++]];else s=r.view[e],a=U(r.view,e);if(a){i=s;break}r=r.parent}t[e]=i}return I(i)&&(i=i.call(this.view)),i};function m(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}m.prototype.clearCache=function(){typeof this.templateCache!="undefined"&&this.templateCache.clear()};m.prototype.parse=function(e,t){var i=this.templateCache,r=e+":"+(t||P.tags).join(":"),s=typeof i!="undefined",o=s?i.get(r):void 0;return o==null&&(o=Se(e,t),s&&i.set(r,o)),o};m.prototype.render=function(e,t,i,r){var s=this.getConfigTags(r),o=this.parse(e,s),u=t instanceof W?t:new W(t,void 0);return this.renderTokens(o,u,i,e,r)};m.prototype.renderTokens=function(e,t,i,r,s){for(var o="",u,a,p,d=0,y=e.length;d<y;++d)p=void 0,u=e[d],a=u[0],a==="#"?p=this.renderSection(u,t,i,r,s):a==="^"?p=this.renderInverted(u,t,i,r,s):a===">"?p=this.renderPartial(u,t,i,s):a==="&"?p=this.unescapedValue(u,t):a==="name"?p=this.escapedValue(u,t,s):a==="text"&&(p=this.rawValue(u)),p!==void 0&&(o+=p);return o};m.prototype.renderSection=function(e,t,i,r,s){var o=this,u="",a=t.lookup(e[1]);function p(b){return o.render(b,t,i,s)}if(!!a){if(L(a))for(var d=0,y=a.length;d<y;++d)u+=this.renderTokens(e[4],t.push(a[d]),i,r,s);else if(typeof a=="object"||typeof a=="string"||typeof a=="number")u+=this.renderTokens(e[4],t.push(a),i,r,s);else if(I(a)){if(typeof r!="string")throw new Error("Cannot use higher-order sections without the original template");a=a.call(t.view,r.slice(e[3],e[5]),p),a!=null&&(u+=a)}else u+=this.renderTokens(e[4],t,i,r,s);return u}};m.prototype.renderInverted=function(e,t,i,r,s){var o=t.lookup(e[1]);if(!o||L(o)&&o.length===0)return this.renderTokens(e[4],t,i,r,s)};m.prototype.indentPartial=function(e,t,i){for(var r=t.replace(/[^ \t]/g,""),s=e.split(`
`),o=0;o<s.length;o++)s[o].length&&(o>0||!i)&&(s[o]=r+s[o]);return s.join(`
`)};m.prototype.renderPartial=function(e,t,i,r){if(!!i){var s=this.getConfigTags(r),o=I(i)?i(e[1]):i[e[1]];if(o!=null){var u=e[6],a=e[5],p=e[4],d=o;a==0&&p&&(d=this.indentPartial(o,p,u));var y=this.parse(d,s);return this.renderTokens(y,t,i,d,r)}}};m.prototype.unescapedValue=function(e,t){var i=t.lookup(e[1]);if(i!=null)return i};m.prototype.escapedValue=function(e,t,i){var r=this.getConfigEscape(i)||P.escape,s=t.lookup(e[1]);if(s!=null)return typeof s=="number"&&r===P.escape?String(s):r(s)};m.prototype.rawValue=function(e){return e[1]};m.prototype.getConfigTags=function(e){return L(e)?e:e&&typeof e=="object"?e.tags:void 0};m.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!L(e))return e.escape};var P={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){T.templateCache=n},get templateCache(){return T.templateCache}},T=new m;P.clearCache=function(){return T.clearCache()};P.parse=function(e,t){return T.parse(e,t)};P.render=function(e,t,i,r){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+de(e)+'" was given as the first argument for mustache#render(template, view, partials)');return T.render(e,t,i,r)};P.escape=Ae;P.Scanner=k;P.Context=W;P.Writer=m;class ke{constructor(e,t){this.template=e,this.state=t,this.ast=P.parse(e)}getValue(){return this.value===void 0&&(this.value=P.render(this.template,this.state)),this.value}onChange(e){const t=[];for(const i of this.getUsedVariables().values())t.push(this.state.onVariableChange(i).subscribe(()=>{const r=P.render(this.template,this.state);r!==this.value&&(this.value=r,e(this.value))}));return{unsubscribe:()=>{for(const i of t)i.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const e=new Set;return this.recursiveGetUsedVariables(this.ast,e),e}recursiveGetUsedVariables(e,t){for(const i of e){const r=i[0],s=i[1],o=i[4];["name","&","#","^"].includes(r)&&t.add(s),o!==void 0&&typeof o!="string"&&this.recursiveGetUsedVariables(o,t)}}}async function xe(){var n;const e=await G();for(const[t,i]of e.entries()){const r=(n=i.properties)!==null&&n!==void 0?n:[];for(const s of r){if(s.type==="int"||s.type==="bool"||s.type==="object"||typeof s.value!="string")continue;const o=new ke(s.value,WA.state);if(o.isPureString())continue;const u=o.getValue();_(t,s.name,u),o.onChange(a=>{_(t,s.name,a)})}}}function _(n,e,t){WA.room.setProperty(n,e,t),e==="visible"&&(t?WA.room.showLayer(n):WA.room.hideLayer(n))}let O,j=0,D=0;function Z(n){if(WA.state[n.name]){let e=n.properties.mustGetString("openLayer");for(const t of e.split(`
`))WA.room.showLayer(t);e=n.properties.mustGetString("closeLayer");for(const t of e.split(`
`))WA.room.hideLayer(t)}else{let e=n.properties.mustGetString("openLayer");for(const t of e.split(`
`))WA.room.hideLayer(t);e=n.properties.mustGetString("closeLayer");for(const t of e.split(`
`))WA.room.showLayer(t)}}function Be(n){const e=n.properties.getString("openSound"),t=n.properties.getNumber("soundRadius");let i=1;if(t){const r=te(n.properties.mustGetString("openLayer").split(`
`));if(r>t)return;i=1-r/t}e&&WA.sound.loadSound(e).play({volume:i})}function Ge(n){const e=n.properties.getString("closeSound"),t=n.properties.getNumber("soundRadius");let i=1;if(t){const r=te(n.properties.mustGetString("closeLayer").split(`
`));if(r>t)return;i=1-r/t}e&&WA.sound.loadSound(e).play({volume:i})}function ee(n){return n.map(e=>O.get(e)).filter(e=>(e==null?void 0:e.type)==="tilelayer")}function te(n){const e=ee(n),t=Y(e),i=((t.right-t.left)/2+t.left)*32,r=((t.bottom-t.top)/2+t.top)*32;return Math.sqrt(Math.pow(j-i,2)+Math.pow(D-r,2))}function qe(n){WA.state.onVariableChange(n.name).subscribe(()=>{WA.state[n.name]?Be(n):Ge(n),Z(n)}),Z(n)}function Me(n,e,t,i){const r=n.name;let s,o,u=!1;const a=t.getString("tag");let p=!0;a&&!WA.player.tags.includes(a)&&(p=!1);const d=!!a;function y(){var l;s&&s.remove(),s=WA.ui.displayActionMessage({message:(l=t.getString("closeTriggerMessage"))!==null&&l!==void 0?l:"Press SPACE to close the door",callback:()=>{WA.state[e.name]=!1,b()}})}function b(){var l;s&&s.remove(),s=WA.ui.displayActionMessage({message:(l=t.getString("openTriggerMessage"))!==null&&l!==void 0?l:"Press SPACE to open the door",callback:()=>{WA.state[e.name]=!0,y()}})}function f(l){const c=Y(ee(e.properties.mustGetString("closeLayer").split(`
`)));o=WA.room.website.create({name:"doorKeypad"+l,url:i+"/keypad.html#"+encodeURIComponent(l),position:{x:c.right*32,y:c.top*32,width:32*3,height:32*4},allowApi:!0})}function v(){o&&(WA.room.website.delete(o.name),o=void 0)}WA.room.onEnterLayer(r).subscribe(()=>{if(u=!0,t.getBoolean("autoOpen")&&p){WA.state[e.name]=!0;return}if(!WA.state[e.name]&&(d&&!p||!d)&&(t.getString("code")||t.getString("codeVariable"))){f(r);return}!p||(WA.state[e.name]?y():b())}),WA.room.onLeaveLayer(r).subscribe(()=>{u=!1,t.getBoolean("autoClose")&&(WA.state[e.name]=!1),s&&s.remove(),v()}),WA.state.onVariableChange(e.name).subscribe(()=>{u&&(!t.getBoolean("autoClose")&&WA.state[e.name]===!0&&y(),o&&WA.state[e.name]===!0&&v(),!t.getBoolean("autoOpen")&&WA.state[e.name]===!1&&b())})}function Qe(n){const e=n.properties.mustGetString("bellSound"),t=n.properties.getNumber("soundRadius");let i=1;if(t){const r=Math.sqrt(Math.pow(n.x-j,2)+Math.pow(n.y-D,2));if(r>t)return;i=1-r/t}WA.sound.loadSound(e).play({volume:i})}function Fe(n){WA.state[n.name]===void 0&&(WA.state[n.name]=0),WA.state.onVariableChange(n.name).subscribe(()=>{WA.state[n.name]&&Qe(n)})}function ze(n,e,t){let i;const r=e.getString("bellPopup");WA.room.onEnterLayer(t).subscribe(()=>{var s;r?i=WA.ui.openPopup(r,"",[{label:(s=e.getString("bellButtonText"))!==null&&s!==void 0?s:"Ring",callback:()=>{WA.state[n]=WA.state[n]+1}}]):WA.state[n]=WA.state[n]+1}),WA.room.onLeaveLayer(t).subscribe(()=>{i&&(i.close(),i=void 0)})}async function Oe(n){n=n!=null?n:B;const e=await le();O=await G();for(const t of e.values())t.properties.get("door")&&qe(t),t.properties.get("bell")&&Fe(t);for(const t of O.values()){const i=new E(t.properties),r=i.getString("doorVariable");if(r&&t.type==="tilelayer"){const o=e.get(r);if(o===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of layer "'+t.name+'"');Me(t,o,i,n)}const s=i.getString("bellVariable");s&&ze(s,i,t.name)}WA.player.onPlayerMove(t=>{j=t.x,D=t.y})}function Ie(n,e){const t=n.getString("bindVariable");if(t){const i=n.get("enterValue"),r=n.get("leaveValue"),s=n.getString("triggerMessage"),o=n.getString("tag");je(t,e,i,r,s,o)}}function je(n,e,t,i,r,s){s&&!WA.player.tags.includes(s)||(t!==void 0&&WA.room.onEnterLayer(e).subscribe(()=>{r||(WA.state[n]=t)}),i!==void 0&&WA.room.onLeaveLayer(e).subscribe(()=>{WA.state[n]=i}))}async function De(){const n=await G();for(const e of n.values()){const t=new E(e.properties);Ie(t,e.name)}}let J;async function Re(n){const e=await WA.room.getTiledMap();n=n!=null?n:B,J=await G();const t=e.layers.find(i=>i.name==="configuration");if(t){const r=new E(t.properties).getString("tag");(!r||WA.player.tags.includes(r))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(n+"/configuration.html",!0)});for(const s of J.values()){const o=new E(s.properties),u=o.getString("openConfig");u&&s.type==="tilelayer"&&Ve(u.split(","),s.name,o)}}}function Ve(n,e,t){let i;const r=t.getString("openConfigAdminTag");let s=!0;r&&!WA.player.tags.includes(r)&&(s=!1);function o(){var a;i&&i.remove(),i=WA.ui.displayActionMessage({message:(a=t.getString("openConfigTriggerMessage"))!==null&&a!==void 0?a:"Press SPACE or touch here to configure",callback:()=>N(n)})}function u(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(e).subscribe(()=>{const a=t.getString("openConfigTrigger");s&&(a&&a==="onaction"?o():N(n))}),WA.room.onLeaveLayer(e).subscribe(()=>{i&&i.remove(),u()})}const He=[{lowerBound:0,uppperBound:.5,config:{width:250,height:390,scale:1}},{lowerBound:.5,uppperBound:.8,config:{width:224,height:350,scale:.9}},{lowerBound:.8,uppperBound:1.25,config:{width:132,height:211,scale:.53}},{lowerBound:1.25,uppperBound:2.28,config:{width:64,height:99,scale:.25}},{lowerBound:1.25,config:{width:39,height:63,scale:.16}}],Ne=[{lowerBound:0,uppperBound:1,config:{width:427,height:270,scale:1}},{lowerBound:1,uppperBound:1.9,config:{width:300,height:188,scale:.7}},{lowerBound:1.9,uppperBound:3.5,config:{width:150,height:94,scale:.35}},{lowerBound:3.5,uppperBound:5,config:{width:93,height:58,scale:.21}},{lowerBound:4,config:{width:75,height:46,scale:.17}}];async function Ue(){var n;const e=WA.player.state.tutorialDone,t=/Mobi|Android/i.test(navigator.userAgent),r=await((n=(await WA.room.getTiledMap()).properties)===null||n===void 0?void 0:n.find(o=>o.name==="tutorial")),s=r&&r.value;if(!e&&s){Ke(t);let o=await WA.player.getPosition(),u;const a=await WA.room.website.get("tutorial"),p=()=>{const v=o.x+a.x+a.width>u.x+u.width,l=o.x+a.x<u.x,c=o.y+a.y+a.height>u.y+u.height,g=o.y+a.y<u.y;v?a.x=-a.width-1.5*16:l&&(a.x=1.5*16),c?a.y=-a.height:g&&(a.y=16)},d=f=>{a.width=f.width,a.height=f.height,a.scale=f.scale},y=f=>{const l=(t?He:Ne).filter(c=>{if(c.lowerBound&&c.uppperBound)return c.lowerBound<f&&f<=c.uppperBound;if(c.lowerBound&&!c.uppperBound)return c.lowerBound<f;if(!c.lowerBound&&c.uppperBound)return f<=c.uppperBound;throw new Error(`Zoom level of: ${f} could not fit in any of the desktopConfig's ranges.`)});d(l[0].config)},b=()=>{if(u===void 0)return;const f=u.zoom;y(f),p()};WA.player.onPlayerMove(f=>{o=f,b()}),WA.camera.onCameraUpdate().subscribe(f=>{u=f,b()}),WA.player.state.tutorialDone=!0}}function Ke(n){let e={allow:"",name:"tutorial",url:B+"/tutorial.html",position:{height:224,width:407,x:16,y:-112},visible:!0,allowApi:!0,origin:"player",scale:.9};n&&(e=H(V({},e),{position:{x:32,y:-225,height:390,width:250},scale:1})),WA.room.website.create(e)}function _e(){return WA.onInit().then(()=>{Oe().catch(n=>console.error(n)),De().catch(n=>console.error(n)),Re().catch(n=>console.error(n)),xe().catch(n=>console.error(n)),Ue().catch(n=>console.error(n))}).catch(n=>console.error(n))}class Ze{constructor(e){h(this,"mainGame");h(this,"endGame",!1);h(this,"currentPopup");h(this,"allObjectsState",[{id:0,an:!0},{id:1,an:!1},{id:2,an:!0},{id:3,an:!0}]);h(this,"resultPopup");this.mainGame=e}startChallenge(){this.onEnterLayer("lightone"),this.onLeaveLayer("lightone"),this.onEnterLayer("lighttwo"),this.onLeaveLayer("lighttwo"),this.onEnterLayer("tv"),this.onLeaveLayer("tv"),this.onEnterLayer("pc"),this.onLeaveLayer("pc"),this.onEnterLayer("endEChallenge"),this.onLeaveLayer("endEChallenge")}onEnterLayer(e){WA.room.onEnterLayer(e).subscribe(()=>{this.endGame||(e=="endEChallenge"?this.endChallenge():this.inFrontOf(e))})}onLeaveLayer(e){WA.room.onLeaveLayer(e).subscribe(()=>{this.currentPopup.close()})}inFrontOf(e){this.currentPopup=WA.ui.openPopup(e+"Popup",e+`
 an/ausschalten? `,[{label:"Ja",className:"primary",callback:t=>{this.turnOnOff(e),setTimeout(()=>{},1e3),t.close()}}])}turnOnOff(e){e=="lightone"&&(this.allObjectsState[0].an=!this.allObjectsState[0].an),e=="lighttwo"&&(this.allObjectsState[1].an=!this.allObjectsState[1].an),e=="tv"&&(this.allObjectsState[2].an=!this.allObjectsState[2].an),e=="pc"&&(this.allObjectsState[3].an=!this.allObjectsState[3].an)}endChallenge(){this.currentPopup=WA.ui.openPopup("endEChallengePopup","Beenden",[{label:"Ja",className:"primary",callback:e=>{!this.allObjectsState[0].an&&!this.allObjectsState[1].an&&!this.allObjectsState[2].an&&!this.allObjectsState[3].an?(this.resultPopup=WA.ui.openPopup("resultEPopup",`Gut gemacht! 
 
Alle Ger\xE4te sind aus.`,[]),this.endGame=!0,this.mainGame.setEndGame(this.endGame),this.mainGame.setPoints(this.mainGame.getPoints()+4),this.mainGame.showPoints()):(this.resultPopup=WA.ui.openPopup("resultEPopup",`Nicht alle Ger\xE4te sind aus! 
 
Versuchen Sie es erneut.`,[]),this.mainGame.setPoints(this.mainGame.getPoints()-1),this.mainGame.showPoints()),setTimeout(()=>{this.resultPopup.close()},2e3),e.close()}}])}}class Je{constructor(e){h(this,"mainGame");h(this,"endGame",!1);h(this,"currentPopup");h(this,"resultPopup");h(this,"takeObjectsArray",[]);this.mainGame=e}startChallenge(){this.onEnterLayer("lib1"),this.onLeaveLayer("lib1"),this.onEnterLayer("lib2"),this.onLeaveLayer("lib2"),this.onEnterLayer("lib3"),this.onLeaveLayer("lib3"),this.onEnterLayer("closet1"),this.onLeaveLayer("closet1"),this.onEnterLayer("closet2"),this.onLeaveLayer("closet2"),this.onEnterLayer("closet3"),this.onLeaveLayer("closet3"),this.onEnterLayer("closet4"),this.onLeaveLayer("closet4"),this.onEnterLayer("endSearch"),this.onLeaveLayer("endSearch")}onEnterLayer(e){e=="endSearch"?WA.room.onEnterLayer(e).subscribe(()=>{this.endGame||this.endChallenge()}):WA.room.onEnterLayer(e).subscribe(()=>{this.endGame||this.inFrontOf(e)})}onLeaveLayer(e){WA.room.onLeaveLayer(e).subscribe(()=>{this.currentPopup.close()})}inFrontOf(e){let t;t=this.objectIn(e),this.currentPopup=WA.ui.openPopup("searchRoomPopup",t+`
 nehmen/ 
 zur\xFCcklegen`,[{label:"Ja",className:"primary",callback:i=>{this.take(t),setTimeout(()=>{},1e3),i.close()}}])}objectIn(e){return e=="lib1"?"Harry Potter BD.1":e=="lib2"?"Der Hobbit":e=="lib3"?"1984":e=="closet1"?"Hammer":e=="closet2"?"Schere":e=="closet3"?"Wasserwaage":e=="closet4"?"Schraubenzieher":""}take(e){this.takeObjectsArray.indexOf(e)>-1?this.delete(this.takeObjectsArray.indexOf(e),this.takeObjectsArray):this.takeObjectsArray.push(e)}endChallenge(){this.currentPopup=WA.ui.openPopup("endSearchPopup","Gegenst\xE4nde abgeben?",[{label:"Ja",className:"primary",callback:e=>{this.takeObjectsArray.indexOf("Der Hobbit")>-1&&this.takeObjectsArray.indexOf("Hammer")>-1&&this.takeObjectsArray.length==2?(this.resultPopup=WA.ui.openPopup("resultSearchPopup",`Gut gemacht. 
 
Alle richtigen Gegenst\xE4nde abgegebenn.`,[]),this.endGame=!0,this.mainGame.setEndGame(this.endGame),this.mainGame.setPoints(this.mainGame.getPoints()+2),this.mainGame.showPoints()):(this.resultPopup=WA.ui.openPopup("resultSearchPopup",`Falsche Abgabe der Gegenst\xE4nde. 
 
 Versuchen Sie es erneut.`,[]),this.mainGame.setPoints(this.mainGame.getPoints()-1),this.mainGame.showPoints()),setTimeout(()=>{this.resultPopup.close()},2e3),e.close()}}])}delete(e,t){e!==-1&&t.splice(e,1)}}class $e{constructor(e,t){h(this,"mainGame");h(this,"currentPopup");h(this,"resultPopup");h(this,"pointsPopup");h(this,"questionPopup");h(this,"currentQ",0);h(this,"quizType");h(this,"correctAnswerArray",["B","C","A","B","A","C","C","A","B","A","B","C","C","A"]);h(this,"points",0);this.mainGame=e,t==2&&(this.currentQ=8),this.quizType=t}startQuiz(){this.pointsPopup=WA.ui.openPopup("points"+this.quizType+"Popup","Punkte:"+this.points,[]),this.onEnterLayer("AZone"),this.onLeaveLayer("AZone"),this.onEnterLayer("BZone"),this.onLeaveLayer("BZone"),this.onEnterLayer("CZone"),this.onLeaveLayer("CZone"),this.quizType==1?this.questionPopup=WA.ui.openPopup("question"+this.quizType+"Popup",`Welchem Unternhemen geh\xF6rte das 
ehemalige Werksgel\xE4nde auf dem das Quartier 
aufgebaut wurde? 
 
A:Bosh    B:Paff   C:Singer`,[]):this.questionPopup=WA.ui.openPopup("question"+this.quizType+"Popup",`Wie viele Starter-Projekte f\xFCr den 
 EnStadt:Pfaff Platform Mock gibt es? 
A:3    B:4   C:5`,[])}onEnterLayer(e){WA.room.onEnterLayer(e).subscribe(()=>{this.currentQ<8&&this.quizType==1?this.standsOn(Array.from(e)[0]):this.currentQ<14&&this.quizType==2&&this.standsOn(Array.from(e)[0])})}onLeaveLayer(e){WA.room.onLeaveLayer(e).subscribe(()=>{this.currentPopup!=null&&this.currentPopup.close()})}standsOn(e){this.currentPopup=WA.ui.openPopup(e+this.quizType+"Popup","Antwort "+e,[{label:"Ja",className:"primary",callback:t=>{this.answer(e)?(this.resultPopup=WA.ui.openPopup("resultQuiz"+this.quizType+"Popup","Richtig",[]),this.pointsPopup.close(),this.points++,this.mainGame.setPoints(this.mainGame.getPoints()+1),this.pointsPopup=WA.ui.openPopup("points"+this.quizType+"Popup","Punkte:"+this.points,[]),this.mainGame.showPoints(),this.currentQ==4?this.openSite("https://www.greenly.earth/en-us","Dr\xFCcke 'space', um Information \xFCber Greenly zu erhalten"):this.currentQ==6?this.openSite("https://www.vrn.de/mobilitaet/fahrrad/vrnnextbike/index.html","Dr\xFCcke 'space', um Information \xFCber VRNnextbike zu erhalten"):this.currentQ==7&&this.openSite("https://olioex.com/food-waste-in/germany/","Dr\xFCcke 'space', um Information \xFCber Olio zu erhalten"),this.nextQ()):(this.resultPopup=WA.ui.openPopup("resultQuiz"+this.quizType+"Popup","Falsch",[]),this.mainGame.setPoints(this.mainGame.getPoints()-1),this.points--,this.pointsPopup.close(),this.pointsPopup=WA.ui.openPopup("points"+this.quizType+"Popup","Punkte:"+this.points,[]),this.mainGame.showPoints()),setTimeout(()=>{this.resultPopup.close()},1e3),t.close()}}])}openSite(e,t){const i=WA.ui.displayActionMessage({message:t,callback:async()=>{const r=await WA.ui.website.open({url:e,position:{vertical:"top",horizontal:"middle"},size:{height:"70vh",width:"70vw"}}),s=WA.ui.displayActionMessage({message:"Dr\xFCcke 'space', um die Webseite zu schlie\xDFen",callback:async()=>{await r.close(),await s.remove()}})}});setTimeout(()=>{i.remove()},3e3)}nextQ(){this.closePopUp(),this.currentQ++,this.currentQ==8&&this.quizType==1&&(this.mainGame.setEndGame(!0),this.pointsPopup.close()),this.currentQ==14&&this.quizType==2&&(this.mainGame.setEndGame(!0),this.pointsPopup.close()),this.currentQ==1&&(this.questionPopup=WA.ui.openPopup("question"+this.quizType+"Popup",`Laut den Klimaschutzzielen der Bundesregierung 
soll bis 2050 die Reduzierung der Treibhauseffekte 
im Vergleich zu 1990 wie hoch ausfallen? 
 
A:20%-30%  B:40%-60%  C:80%-95%`,[])),this.currentQ==2&&(this.questionPopup=WA.ui.openPopup("question"+this.quizType+"Popup",`Wie hoch soll dabei der Anteil 
an erneuerbaren Energien sein? 
 
A:60%  B:30%  C:80%`,[])),this.currentQ==3&&(this.questionPopup=WA.ui.openPopup("question"+this.quizType+"Popup",`Was ist die digitale Quartiersplattform? 
 
  A:Ein App-Store, mit der man sich neue Apps herunterladen kann. 
 
B:Eine Software, sodass die Apps und Dienste des Quartiers 
miteinander kommunizieren k\xF6nnen. 
 
 C:Ein soziales Netzwerk das vom Quartier angeboten wird.`,[])),this.currentQ==4&&(this.questionPopup=WA.ui.openPopup("question"+this.quizType+"Popup",`Welche dieser Apps zeigt den Energieverbrauch  
 deines Haushaltes  an 
und gibt zus\xE4tzlich Tipps, sodass du diesen senken kannst? 
 
A:Greenly  B:Fish n'Tipps  C:Pfaff-Funk`,[])),this.currentQ==5&&(this.questionPopup=WA.ui.openPopup("question"+this.quizType+"Popup",`Wie viele Tipp-Kategorien gibt es 
 in der Fish n' Tipps App? 
 
 A:8  B:10  C:9`,[])),this.currentQ==6&&(this.questionPopup=WA.ui.openPopup("question"+this.quizType+"Popup",`Welches dieser Verkehrsmittel 
ist am Energiesparendsten? 
 
A:Auto  B:E-Auto C:Fahrrad`,[])),this.currentQ==7&&(this.questionPopup=WA.ui.openPopup("question"+this.quizType+"Popup",`Pro Jahr werden in Deutschland 12 Millionen Tonnen 
an Essen verschwendet. Welche App 
hilft dir dabei, diese Lebensmittelverschwendung gezielt zu bek\xE4mpfen 
und gleichzeitig Geld zu sparen? 
 
A:Olio  B:MeDeTe C:Pfaff-Funk`,[])),this.currentQ==9&&(this.questionPopup=WA.ui.openPopup("question"+this.quizType+"Popup",`Wof\xFCr steht MQTT? 
 
A:Message Queuing Telemetry Transport 
 
 B:Message Query Telemetry Transport 
 
 C:Machine Query Telemetry Transport 
 
`,[])),this.currentQ==10&&(this.questionPopup=WA.ui.openPopup("question"+this.quizType+"Popup",`Was sind Shared Topics im MQTT-Broker in erster Linie?
 
 A:Themen, die wichtig f\xFCr Bewohner sind 
 
 B:\xD6ffentliche, Asynchrone Informationskan\xE4le 
 
C:Api-Schnittestelle, mit der Entwickler ihre App 
ver\xF6ffentlichen k\xF6nnen`,[])),this.currentQ==11&&(this.questionPopup=WA.ui.openPopup("question"+this.quizType+"Popup",`Wie viele \u201EShared Topics\u201C sind zurzeit verf\xFCgbar? 
 
A:2  B:6 C:3`,[])),this.currentQ==12&&(this.questionPopup=WA.ui.openPopup("question"+this.quizType+"Popup",`Was kann mit \u201Epublish\u201C 
im Kontext des MQTT-Broker erreicht werden? 
 
A:App/Dienst wird auf der Plattform ver\xF6ffentlicht
und mit dieser verbunden 
 
B:Entwickler k\xF6nnen hiermit einen neuen Topic erstellen 
und ver\xF6ffentlichen 
 
 C:Event-Nachrichten,die nicht spezifisch adressiert werden,
werden in einem Topic ver\xF6ffentlicht`,[])),this.currentQ==13&&(this.questionPopup=WA.ui.openPopup("question"+this.quizType+"Popup",`Wer hat die Befugnisse
auf \u201EService Specific Topics\u201C 
 
 A:Dienstbetreiber  B:Plattformbetreiber  C:Bewohner des Quartiers`,[]))}answer(e){return this.currentQ<=this.correctAnswerArray.length-1?e==this.correctAnswerArray.at(this.currentQ):!1}closePopUp(){this.questionPopup!==void 0&&(this.questionPopup.close(),this.questionPopup=void 0)}}class Xe{constructor(){h(this,"pointsPopup");h(this,"points",0);h(this,"endGame",!0);h(this,"currentPopup");h(this,"instructionPopup");this.points=0,this.endGame=!0}startAllInstructionLayers(){this.onEnterInstructionLayer("instruction1"),this.onLeaveInstructionLayer("instruction1"),this.onEnterInstructionLayer("instruction2"),this.onLeaveInstructionLayer("instruction2"),this.onEnterInstructionLayer("instruction3"),this.onLeaveInstructionLayer("instruction3")}startAllChallengeLayers(){this.onEnterChallengeLayer("startQuiz"),this.onLeaveChallengeLayer("startQuiz"),this.onEnterChallengeLayer("startQuiz2"),this.onLeaveChallengeLayer("startQuiz2"),this.onEnterChallengeLayer("startEChallenge"),this.onLeaveChallengeLayer("startEChallenge"),this.onEnterChallengeLayer("startSearchChallenge"),this.onLeaveChallengeLayer("startSearchChallenge")}onEnterInstructionLayer(e){let t;e=="instruction1"?t=`Das Spiel das Sie gerade spielen, 
wird ihnen die Quartiersplattform 
des Pfaff-Quartiers n\xE4her bringen. 
 
Mit vier Herausforderungen k\xF6nnen Sie 
einige Vorteile der Plattform kennenlernen.`:e=="instruction2"?t=`Wenn Sie weiter gehen, finden Sie den Hauptraum 
mit vier verschiedenen T\xFCren. 
Hinter jeder T\xFCr befindet sich eine Herausforderung. 
 
Sobald Sie eine Herausforderung gestartet haben, 
 m\xFCssen Sie diese auch beenden,
damit Sie die n\xE4chste starten k\xF6nnen. 
 
Kehren Sie immer zur\xFCck zum Hauptraum, um die n\xE4chste Herausforderung zu starten.`:e=="instruction3"&&(t=`F\xFCr jede Herausforderung gibt es Punkte zum Sammeln. 
 
Im Hauptraum k\xF6nnen Sie nach dem Starten 
 der ersten Herausforderung ihre Gesamtpunktzahl einsehen.`),WA.room.onEnterLayer(e).subscribe(()=>{this.instructionPopup=WA.ui.openPopup(e+"Popup",t,[{label:"Close",className:"primary",callback:i=>{i.close()}}])})}onLeaveInstructionLayer(e){WA.room.onLeaveLayer(e).subscribe(()=>{this.instructionPopup.close()})}onLeaveChallengeLayer(e){WA.room.onLeaveLayer(e).subscribe(()=>{this.currentPopup.close()})}onEnterChallengeLayer(e){let t;e=="startQuiz"&&(t=`Quiz f\xFCr Bewohner: 
In diesem Spiel m\xFCssen Sie 8 verschiedene 
Fragen zur Quartiersplattform beantworten. 
 
Pro richtig beantworte Frage kriegen Sie einen Punkt. 
Bei falsch beantwortete Fragen wird 
Ihnen ein Punkt abgezogen. 
 
Einige Fragen bieten Ihnen nach dem Beantworten 
der Frage zus\xE4tzliche Informationen an. 
 
Tipp: Das IKT-Konzept und die Apps der Plattform sind hilfreich f\xFCr das Quiz `),e=="startQuiz2"?t=`Quiz f\xFCr Entwickler: 
In diesem Spiel m\xFCssen Sie 6 verschiedene 
Etnwicklerfragen zur Quartiersplattform beantworten. 
 
Pro richtig beantworte Frage kriegen Sie einen Punkt. 
Bei falsch beantwortete Fragen wird 
Ihnen ein Punkt abgezogen. 
 
Tipp: Das Gitlab zur Plattform Mock wird ihnen bei diesem Quiz helfen `:e=="startEChallenge"?t=`EChallenge: 
In der Wohnung von Maximilian gibt es 4 Ger\xE4te, die jeweils an oder aus sind. 
 
Schalten Sie alle Ger\xE4te aus, die bereits an sind. 
 
Wenn Sie denken, Sie haben alle Ger\xE4te richtig ausgeschaltet, 
gehen Sie zum blauen Feld und beenden die Herausforderung. 
 
F\xFCr das richtige Ausschalten gibt es 4 Punkte. 
 
Ansonsten wird Ihnen ein Punkt abgezogen 
 und k\xF6nnen dann wieder einen Versuch starten. 
 
Tipp f\xFCr die Lampen: Fish n' Tipps Kategorie Energie`:e=="startSearchChallenge"&&(t=`SearchChallenge: 
Bei MeDeTe hat sich ein Bewohner gemeldet. 
 
Er w\xFCrde sich gerne das Buch Der Hobbit 
und einen Hammer ausleihen. 
 
Geben Sie die richtigen Gegenst\xE4nde ab, erhalten Sie 2 Punkte. 
 
Ansonsten wird Ihnen ein Punkt abgezogen.`),WA.room.onEnterLayer(e).subscribe(()=>{this.currentPopup=WA.ui.openPopup(e+"Popup",t,[{label:"Starten",className:"primary",callback:i=>{e=="startQuiz"&&this.startQuiz(1),e=="startQuiz2"?this.startQuiz(2):e=="startEChallenge"?this.startEChallenge():e=="startSearchChallenge"&&this.startSearchChallenge(),setTimeout(()=>{this.currentPopup.close()},1e3),i.close()}}])})}startEChallenge(){if(this.endGame){let e;e=new Ze(this),this.endGame=!1,e.startChallenge()}}startSearchChallenge(){if(this.endGame){let e;e=new Je(this),this.endGame=!1,e.startChallenge()}}startQuiz(e){if(this.endGame){let t;t=new $e(this,e),this.endGame=!1,t.startQuiz()}}getPoints(){return this.points}setPoints(e){this.points=e}setEndGame(e){this.endGame=e}showPoints(){this.pointsPopup!=null&&this.pointsPopup.close(),this.pointsPopup=WA.ui.openPopup("pointsAllPopup",`Gesamtpunktzahl: 
 `+this.points,[])}}console.log("Script started successfully");let z;WA.onInit().then(()=>{z=new Xe,console.log("Scripting API ready"),console.log("Player tags: ",WA.player.tags),z.startAllChallengeLayers(),z.startAllInstructionLayers(),_e().then(()=>{console.log("Scripting API Extra ready")}).catch(n=>console.error(n))}).catch(n=>console.error(n));
